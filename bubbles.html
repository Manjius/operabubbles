<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="5 reasons to join Opera & Bubbles in Eindhoven for a unique late-morning brunch performance."
    />
    <title>Opera & Bubbles</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600;700&family=Playfair+Display:wght@700;800;900&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        --hero-bg: #f7e7ce;
        --hero-gold: #8b7342;
        --hero-text: #1f1f1f;
        --font-heading: "Playfair Display", serif;
        --font-body: "Lora", serif;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding-bottom: 5.3rem;
        font-family: var(--font-body);
        font-weight: 600;
        color: var(--hero-text);
        background-color: var(--hero-bg);
      }

      .top-header-image {
        width: 100%;
        overflow: hidden;
      }

      .top-header-image img {
        display: block;
        width: 100%;
        height: auto;
      }

      .page-title {
        padding: clamp(1.4rem, 3vw, 2.4rem) clamp(1.2rem, 4vw, 4rem) 0;
        text-align: center;
      }

      .page-title h1 {
        margin: 0;
        font-family: var(--font-heading);
        font-size: clamp(2.4rem, 6vw, 4.5rem);
        font-weight: 700;
        color: var(--hero-gold);
        line-height: 1.12;
      }

      .page-title p {
        margin: 0.35rem 0 0;
        font-size: clamp(1.3rem, 2.73vw, 1.69rem);
        font-family: var(--font-body);
        font-weight: 700;
        color: #000;
      }

      .event-meta {
        padding: clamp(1rem, 3vw, 2rem) clamp(1.2rem, 4vw, 4rem);
      }

      .event-meta__grid {
        width: min(1300px, 100%);
        margin: 0 auto;
        display: grid;
        grid-template-columns: repeat(4, minmax(160px, 1fr));
        gap: clamp(1rem, 2vw, 1.5rem);
      }

      .event-meta__item h3 {
        margin: 0 0 0.25rem;
        font-family: var(--font-heading);
        font-size: clamp(2.2rem, 6vw, 4.2rem);
        font-weight: 900;
      }

      .event-meta__item {
        text-align: center;
        opacity: 0;
        transform: translateX(-70px);
        transition: opacity 0.8s ease, transform 0.8s ease;
        will-change: opacity, transform;
      }

      .event-meta__item:nth-child(even) {
        transform: translateX(70px);
      }


      .event-meta__item p {
        margin: 0;
        font-size: clamp(1.37rem, 2.6vw, 1.56rem);
        line-height: 1.35;
        font-family: var(--font-body);
        font-weight: 700;
      }

      .event-meta__item a {
        color: #000;
        font-family: var(--font-body);
        font-weight: 700;
      }


      .mascot-cta {
        position: fixed;
        left: 1rem;
        bottom: 1rem;
        z-index: 20;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        gap: 0.4rem;
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
        will-change: transform;
        cursor: grab;
      }

      .mascot-cta--entering {
        top: 50%;
        right: 1rem;
        bottom: auto;
        left: auto;
        opacity: 1;
        visibility: visible;
        /*animation: mascot-entry 3.8s ease-in-out forwards;*/
        animation: mascot-entry 2s linear forwards;
      }

      .mascot-cta--active {
        top: 50%;
        right: 1rem;
        bottom: auto;
        left: auto;
        transform: translateY(-50%);
        opacity: 1;
        visibility: visible;
        pointer-events: auto;
        align-items: flex-end;
      }

      .mascot-cta.is-dragging {
        cursor: grabbing;
      }

      .mascot-cta__bubble {
        display: block;
        position: relative;
        max-width: min(280px, 72vw);
        padding: 0.6rem 0.75rem;
        border-radius: 9998rem;
        border: 1px solid rgba(58, 58, 58, 0.2);
        background: rgba(255, 255, 255, 1);
        font-size: 0.9rem;
        line-height: 1.35;
        color: #000;
        box-shadow: 0 8px 18px rgba(0, 0, 0, 0.15);
        text-decoration: none;
        opacity: 0;
        visibility: hidden;
        transform: translateY(8px);
        transition: opacity 0.4s ease, transform 0.4s ease;
      }

      .mascot-cta--active .mascot-cta__bubble {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      .mascot-cta__bubble::after {
        content: "";
        position: absolute;
        right: 2rem;
        bottom: -7px;
        width: 12px;
        height: 12px;
        background: inherit;
        border-right: 1px solid rgba(58, 58, 58, 0.2);
        border-bottom: 1px solid rgba(58, 58, 58, 0.2);
        transform: rotate(45deg);
      }

      .mascot-cta__image {
        display: block;
        width: clamp(72px, 9vw, 110px);
        height: auto;
        transform-origin: center;
      }

      .mascot-cta--active .mascot-cta__image {
        animation: mascot-zoom 2.75s ease-in-out infinite;
      }

      @keyframes mascot-zoom {
        0%,
        72.73%,
        100% {
          transform: scale(1);
        }
        36.36% {
          transform: scale(1.12);
        }
      }

      @keyframes mascot-entry {
        0%   { transform: translate(-60vw, -13vh) scale(0.06); }
        20%  { transform: translate(-60vw, -13vh) scale(2.8); }
        40%  { transform: translate(-40vw, -13vh) scale(1); }
        55%  { transform: translate(-30vw, -13vh) scale(2.8); }
        70%  { transform: translate(-20vw, -13vh) scale(1); }
        85%  { transform: translate(-10vw, -13vh) scale(2.8); }
        100% { transform: translateY(-50%) scale(1); }
        /*100% { transform: translate(calc(100vw - 11rem), calc(-50vh + 5rem)) scale(1); }*/
      }


      .intro-section__subheading {
        margin: 1.4rem 0 0.75rem;
        font-family: var(--font-heading);
        font-size: clamp(2rem, 4.8vw, 3.2rem);
        font-weight: 700;
        line-height: 1.1;
        color: var(--hero-gold);
      }

      .intro-section .hero__body ul {
        margin: 0.2rem 0 1rem;
        padding-left: 1.25rem;
      }

      .intro-section .hero__body {
        text-align: center;
      }


      .hero {
        position: relative;
        isolation: isolate;
        min-height: 100vh;
        width: 100%;
        display: flex;
        align-items: center;
        padding: clamp(2rem, 6vw, 5rem) clamp(1.2rem, 4vw, 4rem);
        background-color: var(--hero-bg);
      }


      .hero__grid {
        width: min(1300px, 100%);
        margin: 0 auto;
        display: grid;
        grid-template-columns: minmax(320px, 1fr) minmax(320px, 1fr);
        gap: clamp(1.5rem, 4vw, 4rem);
        align-items: center;
      }

      .hero__media {
        width: 100%;
      }

      .hero__media img {
        display: block;
        width: 100%;
        aspect-ratio: 4 / 5;
        min-height: 420px;
        object-fit: cover;
      }

      .hero__content {
        width: min(560px, 100%);
        justify-self: center;
      }

      .hero__rule {
        width: clamp(90px, 18vw, 150px);
        height: 2px;
        background-color: var(--hero-gold);
        margin: 0 auto 1.4rem;
      }

      .hero__title {
        margin: 0 0 1.5rem;
        text-align: center;
        font-family: var(--font-heading);
        font-size: clamp(2.4rem, 6vw, 4.5rem);
        font-weight: 700;
        line-height: 1.1;
        color: var(--hero-gold);
      }

      .hero__body {
        font-family: var(--font-body);
        font-size: calc(clamp(1rem, 2.1vw, 1.12rem)*1.3);
        line-height: 1.375;
      }

      .hero__body p {
        margin: 0 0 1rem;
      }

      .hero__body ol {
        margin: 0 0 1rem;
        padding-left: 1.25rem;
      }

      .hero__body li {
        margin-bottom: 0.9rem;
      }

      .hero__body li em {
        display: block;
        font-style: italic;
        font-weight: 700;
      }

      .reasons-list li::marker {
        font-weight: 700;
      }

      .reasons-list li strong {
        display: block;
        font-family: var(--font-heading);
        font-weight: 900;
      }

      .hero__body p:last-child {
        margin-bottom: 0;
      }



      .bubble-rails {
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: 10;
      }

      .bubble-side {
        position: absolute;
        top: 0;
        bottom: 0;
        width: clamp(56px, 8vw, 90px);
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: clamp(3px, 0.5vw, 8px);
      }

      .bubble-side--left {
        left: 0;
      }

      .bubble-side--right {
        right: 0;
      }

      .bubble-rail {
        position: relative;
        overflow: visible;
      }

      .champagne-bubble {
        position: absolute;
        left: 50%;
        padding: 0;
        border-radius: 50%;
        aspect-ratio: 1 / 1;
        border: 1px solid rgba(255, 255, 255, 0.78);
        background: radial-gradient(circle at 30% 28%, rgba(255, 255, 255, 0.96), rgba(255, 255, 255, 0.36) 44%, rgba(255, 228, 145, 0.14));
        box-shadow: 0 0 8px rgba(255, 245, 200, 0.24);
        appearance: none;
        pointer-events: auto;
        cursor: pointer;
        will-change: transform, opacity;
      }

      .champagne-bubble--popping {
        pointer-events: none;
      }



      .fixed-menu {
        position: fixed;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 30;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 1rem;
        padding: 0.7rem 1rem;
        background: #000;
        color: var(--hero-bg);
        border-top: 1px solid rgba(255, 255, 255, 0.2);
      }

      .menu-links {
        display: flex;
        align-items: center;
        gap: 0.65rem;
      }

      .menu-icon-link {
        display: grid;
        place-items: center;
        width: 2rem;
        height: 2rem;
        color: var(--hero-bg);
        text-decoration: none;
      }

      .menu-icon-link svg {
        width: 1.6rem;
        height: 1.6rem;
      }

      .menu-message {
        margin: 0;
        font-size: 0.84rem;
        line-height: 1.35;
        text-align: right;
        max-width: 68ch;
        color: var(--hero-bg);
      }

      .menu-message a {
        color: var(--hero-bg);
      }


      @media (min-width: 901px) {
        .top-header-image img {
          margin-top: -40px;
          margin-bottom: -400px;
        }
      }

      @media (max-width: 900px) {
        .event-meta__grid {
          grid-template-columns: repeat(2, minmax(180px, 1fr));
        }

        .bubble-side {
          width: clamp(64px, 13vw, 102px);
          gap: clamp(2px, 0.9vw, 6px);
        }
        .bubble-rail {
          width: clamp(72px, 11vw, 96px);
        }
        .hero {
          min-height: auto;
          background-attachment: fixed;
        }

        .hero__grid {
          grid-template-columns: 1fr;
        }

        .hero__content {
          order: 1;
        }

        .hero__media {
          order: 2;
        }

        .hero__content {
          width: 100%;
        }
      }


      @media (max-width: 760px) {
        .event-meta__grid {
          grid-template-columns: 1fr;
        }

        body {
          padding-bottom: 7rem;
        }

        .fixed-menu {
          display: flex;               /* in case it isn’t already */
          flex-direction: row;         /* key change */
          align-items: center;         /* vertical align */
          justify-content: space-between;
          gap: 0.8rem;
          padding: 0.7rem 0.85rem;
        }

        .menu-message {
          margin:0;
          flex:1 1 auto;          /* text takes remaining space */
          text-align:right;
          min-width:0;            /* allows wrapping instead of pushing layout */
        }

        .event-meta__item:nth-child(odd) {
          transform: translateX(-70px);
        }

        .event-meta__item:nth-child(even) {
          transform: translateX(70px);
        }
      }

      @media (min-width: 761px) {
        .event-meta__item,
        .event-meta__item:nth-child(even) {
          transform: translateX(-70px);
        }
      }


      .event-meta__item.is-visible,
      .event-meta__item:nth-child(even).is-visible,
      .event-meta__item:nth-child(odd).is-visible {
        opacity: 1;
        transform: translateX(0);
      }

      @media (prefers-reduced-motion: reduce) {
        .event-meta__item,
        .event-meta__item:nth-child(even),
        .event-meta__item:nth-child(odd) {
          opacity: 1;
          transform: none;
          transition: none;
        }
      }

    </style>
  </head>
  <body>
    <div class="top-header-image" aria-hidden="true">
      <img src="assets/header_image.jpg" alt="" />
    </div>

    <div class="mascot-cta" aria-label="Booking reminder" data-mascot-cta>
      <a class="mascot-cta__bubble" href="https://shop.weeztix.com/f1709a7e-0b37-11f1-a9cb-7e126431635e/tickets" target="_blank" rel="noopener noreferrer"><strong>Secure your<br>ticket gurl!!</Strong></strong></a>
      <a href="https://shop.weeztix.com/f1709a7e-0b37-11f1-a9cb-7e126431635e/tickets" target="_blank" rel="noopener noreferrer" aria-label="Book a ticket">
        <img class="mascot-cta__image" src="assets/annaface.png" alt="Animated character reminding guests to book" />
      </a>
    </div>



    <div class="bubble-rails" aria-hidden="true">
      <div class="bubble-side bubble-side--left" data-side="left">
        <div class="bubble-rail" data-lane="1"></div>
        <div class="bubble-rail" data-lane="2"></div>
        <div class="bubble-rail" data-lane="3"></div>
      </div>
      <div class="bubble-side bubble-side--right" data-side="right">
        <div class="bubble-rail" data-lane="1"></div>
        <div class="bubble-rail" data-lane="2"></div>
        <div class="bubble-rail" data-lane="3"></div>
      </div>
    </div>

    <header class="page-title" aria-labelledby="page-main-title">
      <h1 id="page-main-title">Opera &amp; Bubbles: Audition edition</h1>
      <p>A brunch show where you are the chosen one</p>
    </header>

    <section class="event-meta" aria-label="Event details">
      <div class="event-meta__grid">
        <article class="event-meta__item">
          <h3>Date &amp; Time</h3>
          <p>Première on 15th of march</p>
          <p>From 12:00 till 14:00</p>
        </article>

        <article class="event-meta__item">
          <h3>Venue</h3>
          <p>
            <a href="https://maps.app.goo.gl/FtKEz1qm4nXC1wRy6" target="_blank" rel="noopener noreferrer">Blue Collar Theater in Klokgebouw</a>
          </p>
        </article>

        <article class="event-meta__item">
          <h3>Price</h3>
          <p>65€ (incl. Unlimited bubbles and brunch)</p>
        </article>

        <article class="event-meta__item">
          <h3>How to book</h3>
          <p>
            <a href="https://shop.weeztix.com/f1709a7e-0b37-11f1-a9cb-7e126431635e/tickets" target="_blank" rel="noopener noreferrer">Klick here to secure your place!</a>
          </p>
          <p>Seats are limited!</p>
        </article>
      </div>
    </section>


    <section class="hero intro-section" aria-labelledby="intro-section-title">
      <div class="hero__grid">
        <div class="hero__media intro-section__media">
          <img src="assets/blok1_image.jpg" alt="Opera & Bubbles brunch guests enjoying an immersive performance" />
        </div>

        <div class="hero__content">
          <div class="hero__rule" aria-hidden="true"></div>
          <h2 id="intro-section-title" class="hero__title">What is Opera &amp; Bubbles brunch show</h2>

          <div class="hero__body">
            <p>The secret opera brunch in Eindhoven.</p>
            <p>
              Opera &amp; Bubbles blends opera, musical and storytelling into one sparkling, immersive brunch
              experience.
            </p>
            <p>Seduction. Laughter. Opera closer than you ever imagined.</p>
            <p>Only at Klokgebouw, Blue Collar Theater.</p>

          </div>
        </div>

      </div>
    </section>

    <section class="hero" aria-labelledby="experience-music-title">
      <div class="hero__grid">
        <div class="hero__content">
                  <div class="hero__rule" aria-hidden="true"></div>
          <h2 id="opera-bubbles-reasons-title" class="hero__title">5 Reasons to Join Opera &amp; Bubbles</h2>

          <div class="hero__body">
            <ol class="reasons-list">
              <li>
                <strong>Treat yourself to an absolutely unique brunch experience</strong>
                You enjoy a full brunch while listening to live opera, musical theatre and theatrical drama. Not
                background music. A real performance. For the price of a simple restaurant visit.
              </li>
              <li>
                <strong>It’s a special late morning plan</strong>
                No late nights. No rushing next morning. Just a beautiful, slow weekend morning filled with music,
                bubbles and nice atmosphere.
              </li>
              <li>
                <strong>It’s in the heart of Eindhoven</strong>
                Located in the iconic Klokgebouw, right in the vibrant Strijp-s .Easy to reach, impossible to forget.
              </li>
              <li>
                <strong>It’s perfect for dates, friends or colleagues</strong>
                Make memories with your partner. Laugh with your best friends and siblings. Surprise your colleagues.
                It works for everyone.
              </li>
              <li>
                <strong>It’s interactive, memorable and welcoming</strong>
                You are gently included, never pressured. The atmosphere is warm, safe and inviting, whether you love
                opera or have never heard it live before.
              </li>
            </ol>
          </div>
        </div>
        <div class="hero__media">
          <img src="assets/blok2_image.jpeg" alt="Opera & Bubbles performers and guests during brunch theatre" />
        </div>
      </div>
    </section>

    <section class="hero" aria-labelledby="opera-bubbles-reasons-title">
      <div class="hero__grid">
        <div class="hero__media">
          <img
            src="assets/brunch-photo.jpg"
            alt="Guests raising brunch glasses at a lively Opera & Bubbles brunch"
          />
        </div>

        <div class="hero__content">
          <div class="hero__rule" aria-hidden="true"></div>
          <h2 id="experience-music-title" class="hero__title">The Experience</h2>

          <div class="hero__body">
            
            <p>Over approximately two to two and a half hours, you will experience:</p>
            <ul>
              <li>A relaxed brunch with soup, sandwiches, snacks, dessert and endless bubbles</li>
              <li>Live opera and musical performed by Anna Karnovska and accompanied by Vera Fonte</li>
              <li>Theater with professional performers</li>
              <li>Audience participation that is playful and surely optional</li>
              <li>Moments of humor, honesty, and recognition</li>
            </ul>


          </div>
        </div>
      </div>
    </section>


    <footer class="fixed-menu" aria-label="Contact and social media menu">
      <div class="menu-links">
        <a
          class="menu-icon-link"
          href="https://www.instagram.com/serious_case/?hl=en"
          target="_blank"
          rel="noopener noreferrer"
          aria-label="Instagram"
        >
          <svg viewBox="0 0 24 24" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="18" height="18" rx="5" ry="5"></rect>
            <circle cx="12" cy="12" r="4.1"></circle>
            <circle cx="17.3" cy="6.7" r="0.8" fill="currentColor" stroke="none"></circle>
          </svg>
        </a>
        <a
          class="menu-icon-link"
          href="https://karnovska.art/"
          target="_blank"
          rel="noopener noreferrer"
          aria-label="Website"
        >
          <svg viewBox="0 0 24 24" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="9"></circle>
            <path d="M3 12h18"></path>
            <path d="M12 3a14 14 0 0 1 0 18"></path>
            <path d="M12 3a14 14 0 0 0 0 18"></path>
          </svg>
        </a>
      </div>
      <p class="menu-message">
        Special dietary wishes? Our contact is:
        <a href="mailto:anna.karnovska@gmail.com">anna.karnovska@gmail.com</a>.
      </p>
    </footer>

    <script>
      (() => {
        const items = Array.from(document.querySelectorAll('.event-meta__item'));
        if (!items.length) return;

        const revealOrder = new Map(items.map((item, index) => [item, index]));
        const queuedItems = [];
        const queuedSet = new Set();
        const initialRevealDelayMs = 500;
        const mobileRevealGapMs = 250;
        let nextRevealAt = 0;
        let queueActive = false;

        const flushQueue = () => {
          if (queueActive || !queuedItems.length) return;
          queueActive = true;

          const runNext = () => {
            const nextItem = queuedItems.shift();
            if (!nextItem) {
              queueActive = false;
              return;
            }

            queuedSet.delete(nextItem);

            const now = performance.now();
            if (now >= nextRevealAt) {
              nextRevealAt = now + initialRevealDelayMs;
            }

            const delay = Math.max(nextRevealAt - now, 0);
            window.setTimeout(() => {
              nextItem.classList.add('is-visible');
              nextRevealAt += mobileRevealGapMs;
              runNext();
            }, delay);
          };

          runNext();
        };

        const observer = new IntersectionObserver(
          (entries, currentObserver) => {
            const newlyVisible = entries
              .filter((entry) => entry.isIntersecting)
              .map((entry) => entry.target)
              .sort((a, b) => revealOrder.get(a) - revealOrder.get(b));

            const isDesktop = window.matchMedia('(min-width: 761px)').matches;

            if (isDesktop) {
              newlyVisible.forEach((target) => {
                currentObserver.unobserve(target);
              });

              if (newlyVisible.length) {
                window.setTimeout(() => {
                  newlyVisible.forEach((target) => target.classList.add('is-visible'));
                }, initialRevealDelayMs);
              }

              return;
            }

            newlyVisible.forEach((target) => {
              if (queuedSet.has(target)) return;
              queuedSet.add(target);
              queuedItems.push(target);
              currentObserver.unobserve(target);
            });

            flushQueue();
          },
          {
            threshold: 0.35,
            rootMargin: '0px 0px -10% 0px',
          }
        );

        items.forEach((item) => observer.observe(item));
      })();
    </script>

    <script>
      (() => {
        const rails = Array.from(document.querySelectorAll('.bubble-rail'));
        if (!rails.length) return;

        const bubbles = [];
        const spawnDelayMs = 950;
        const spawnJitterMs = 420;
        const nextSpawnAt = new Map(rails.map((rail) => [rail, Math.random() * (spawnDelayMs + spawnJitterMs)]));
        const baseRiseSpeed = 102;
        const scrollModeHoldMs = 180;
        const maxBubbles = 72;
        let scrollMode = 'idle';
        let scrollModeUntil = 0;
        let lastTimestamp;
        let lastScrollY = window.scrollY;

        const removeBubble = (bubble) => {
          bubble.el.remove();
          const idx = bubbles.indexOf(bubble);
          if (idx !== -1) bubbles.splice(idx, 1);
        };

        const popBubble = (bubble, duration = 220) => {
          if (!bubble || bubble.popping) return;
          bubble.popping = true;
          bubble.el.classList.add('champagne-bubble--popping');
          const currentTransform = bubble.el.style.transform || `translate3d(${bubble.x}px, ${bubble.y}px, 0)`;
          const animation = bubble.el.animate(
            [
              { transform: currentTransform, opacity: 1 },
              { transform: `${currentTransform} scale(1.5)`, opacity: 0 },
            ],
            { duration, easing: 'ease-out', fill: 'forwards' }
          );
          animation.addEventListener('finish', () => removeBubble(bubble), { once: true });
        };

        const makeBubble = (rail) => {
          if (bubbles.length >= maxBubbles) {
            popBubble(bubbles[0], 140);
            return;
          }

          const size = 2 + Math.random() * 2.5;
          const maxDrift = Math.max((rail.clientWidth - size) / 2 - 1.5, 0);
          const offsetX = (Math.random() * 2 - 1) * maxDrift;
          const bubbleEl = document.createElement('button');
          bubbleEl.type = 'button';
          bubbleEl.className = 'champagne-bubble';
          bubbleEl.setAttribute('aria-label', 'Pop bubble');
          bubbleEl.style.width = `${size}px`;
          bubbleEl.style.height = `${size}px`;

          const bubble = {
            el: bubbleEl,
            rail,
            size,
            x: offsetX,
            y: rail.clientHeight - size,
            popping: false,
          };

          bubbleEl.addEventListener('pointerdown', () => popBubble(bubble));
          bubbleEl.addEventListener('click', () => popBubble(bubble));

          rail.appendChild(bubbleEl);
          bubbles.push(bubble);
        };

        const updateScrollMode = () => {
          const currentY = window.scrollY;
          const delta = currentY - lastScrollY;
          const now = performance.now();

          if (delta > 0) {
            scrollMode = 'down';
            scrollModeUntil = now + scrollModeHoldMs;
          } else if (delta < 0) {
            scrollMode = 'up';
            scrollModeUntil = now + scrollModeHoldMs;
          }

          lastScrollY = currentY;
        };

        window.addEventListener('scroll', updateScrollMode, { passive: true });

        const frame = (timestamp) => {
          if (!lastTimestamp) {
            lastTimestamp = timestamp;
            requestAnimationFrame(frame);
            return;
          }

          const dt = Math.min((timestamp - lastTimestamp) / 1000, 0.04);
          lastTimestamp = timestamp;

          if (scrollModeUntil && timestamp > scrollModeUntil) {
            scrollMode = 'idle';
            scrollModeUntil = 0;
          }

          let riseMultiplier = 1;
          if (scrollMode === 'down') {
            riseMultiplier = 2;
          } else if (scrollMode === 'up') {
            riseMultiplier = 0;
          }

          rails.forEach((rail) => {
            const next = nextSpawnAt.get(rail) - dt * 1000;
            if (next <= 0) {
              makeBubble(rail);
              const randomizedDelay = spawnDelayMs + Math.random() * spawnJitterMs;
              nextSpawnAt.set(rail, randomizedDelay);
            } else {
              nextSpawnAt.set(rail, next);
            }
          });

          for (let i = bubbles.length - 1; i >= 0; i -= 1) {
            const bubble = bubbles[i];
            if (bubble.popping) continue;

            bubble.y -= baseRiseSpeed * riseMultiplier * dt;
            bubble.el.style.transform = `translate3d(${bubble.x}px, ${bubble.y}px, 0)`;

            if (bubble.y + bubble.size <= 2) {
              popBubble(bubble, 180);
            }
          }

          requestAnimationFrame(frame);
        };

        requestAnimationFrame(frame);
      })();
    </script>

    <script>
      (() => {
        const mascotCta = document.querySelector('[data-mascot-cta]');
        const headerImage = document.querySelector('.top-header-image');

        if (!mascotCta || !headerImage) {
          return;
        }

        let hasStarted = false;
        let dragState = null;
        let suppressNextClick = false;

        const clamp = (value, min, max) => Math.min(Math.max(value, min), max);

        const setDraggedPosition = (clientX, clientY) => {
          const ctaRect = mascotCta.getBoundingClientRect();
          const maxLeft = Math.max(window.innerWidth - ctaRect.width, 0);
          const maxTop = Math.max(window.innerHeight - ctaRect.height, 0);

          const nextLeft = clamp(clientX - dragState.offsetX, 0, maxLeft);
          const nextTop = clamp(clientY - dragState.offsetY, 0, maxTop);

          mascotCta.style.left = `${nextLeft}px`;
          mascotCta.style.top = `${nextTop}px`;
          mascotCta.style.right = 'auto';
          mascotCta.style.bottom = 'auto';
          mascotCta.style.transform = 'none';
        };

        const handlePointerMove = (event) => {
          if (!dragState) return;

          const moveDistance = Math.hypot(event.clientX - dragState.startX, event.clientY - dragState.startY);
          if (moveDistance > 4) {
            dragState.moved = true;
          }

          setDraggedPosition(event.clientX, event.clientY);
        };

        const handlePointerUp = () => {
          if (!dragState) return;

          mascotCta.classList.remove('is-dragging');
          if (dragState.pointerId !== null) {
            mascotCta.releasePointerCapture(dragState.pointerId);
          }

          if (dragState.moved) {
            suppressNextClick = true;
          }

          window.removeEventListener('pointermove', handlePointerMove);
          window.removeEventListener('pointerup', handlePointerUp);
          window.removeEventListener('pointercancel', handlePointerUp);
          dragState = null;
        };

        const startDrag = (event) => {
          if (!mascotCta.classList.contains('mascot-cta--active')) {
            return;
          }

          event.preventDefault();

          const ctaRect = mascotCta.getBoundingClientRect();
          dragState = {
            pointerId: event.pointerId,
            offsetX: event.clientX - ctaRect.left,
            offsetY: event.clientY - ctaRect.top,
            startX: event.clientX,
            startY: event.clientY,
            moved: false,
          };

          mascotCta.classList.add('is-dragging');
          mascotCta.setPointerCapture(event.pointerId);

          window.addEventListener('pointermove', handlePointerMove);
          window.addEventListener('pointerup', handlePointerUp);
          window.addEventListener('pointercancel', handlePointerUp);

          setDraggedPosition(event.clientX, event.clientY);
        };

        mascotCta.addEventListener('pointerdown', startDrag);
        mascotCta.addEventListener('click', (event) => {
          if (!suppressNextClick) {
            return;
          }

          suppressNextClick = false;
          event.preventDefault();
        });

        const activateMascot = () => {
          if (hasStarted) {
            return;
          }

          hasStarted = true;
          mascotCta.classList.add('mascot-cta--entering');

          mascotCta.addEventListener(
            'animationend',
            () => {
              mascotCta.classList.remove('mascot-cta--entering');
              mascotCta.classList.add('mascot-cta--active');
            },
            { once: true }
          );
        };

        const checkScrollPosition = () => {
          const pastHeaderImage = window.scrollY > headerImage.offsetHeight;

          if (pastHeaderImage) {
            activateMascot();
            window.removeEventListener('scroll', checkScrollPosition);
          }
        };

        window.addEventListener('scroll', checkScrollPosition, { passive: true });
        checkScrollPosition();
      })();
    </script>
  </body>
</html>
